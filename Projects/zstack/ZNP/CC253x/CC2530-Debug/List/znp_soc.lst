###############################################################################
#                                                                             #
# IAR C/C++ Compiler V8.10.1.10194/W32 for 8051         20/Mar/2014  13:24:25 #
# Copyright 2004-2011 IAR Systems AB.                                         #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data_rom                                           #
#    Dptr setup         =  1,16                                               #
#    Source file        =  C:\Documents and Settings\Administrator\×ÀÃæ\1\Tem #
#                          coZNP\Projects\zstack\ZNP\CC253x\Source\znp_soc.c  #
#    Command line       =  -f "C:\Documents and Settings\Administrator\×ÀÃæ\1 #
#                          \TemcoZNP\Projects\zstack\ZNP\CC253x\..\Source\znp #
#                          .cfg" (-DMAC_CFG_APP_PENDING_QUEUE=TRUE            #
#                          "-DZSTACK_DEVICE_BUILD=(DEVICE_BUILD_COORDINATOR   #
#                          | DEVICE_BUILD_ROUTER | DEVICE_BUILD_ENDDEVICE)"   #
#                          -DNWK_AUTO_POLL -DZNP_RUN_WDOG=FALSE -DZIGBEEPRO   #
#                          -DZIGBEE_FRAGMENTATION -DOSAL_CLOCK                #
#                          -DOSAL_SAPI=FALSE -DSAPI_CB_FUNC=FALSE -DNV_INIT   #
#                          -DNUM_DISC_ATTEMPTS=0) -f "C:\Documents and        #
#                          Settings\Administrator\×ÀÃæ\1\TemcoZNP\Projects\zs #
#                          tack\ZNP\CC253x\..\..\Tools\CC2530DB\f8wConfig.cfg #
#                          " (-DZIGBEEPRO -DSECURE=0 -DZG_SECURE_DYNAMIC=0    #
#                          -DREFLECTOR -DDEFAULT_CHANLIST=0x00001000          #
#                          -DZDAPP_CONFIG_PAN_ID=0xFFFF                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DLINK_STATUS_JITTER_MASK=0x007F                   #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3    #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40           #
#                          -DNWK_MAX_BINDING_ENTRIES=4                        #
#                          -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DMAC_MAX_FRAME_SIZE=116                           #
#                          -DZDNWKMGR_MIN_TRANSMISSIONS=20 "-DCONST=const     #
#                          __code" -DGENERIC=__generic                        #
#                          -DRFD_RCVC_ALWAYS_ON=FALSE -DPOLL_RATE=1000        #
#                          -DQUEUED_POLL_RATE=100 -DRESPONSE_POLL_RATE=100    #
#                          -DREJOIN_POLL_RATE=440) -f "C:\Documents and       #
#                          Settings\Administrator\×ÀÃæ\1\TemcoZNP\Projects\zs #
#                          tack\ZNP\CC253x\..\..\Tools\CC2530DB\f8wZCL.cfg"   #
#                          "C:\Documents and Settings\Administrator\×ÀÃæ\1\Te #
#                          mcoZNP\Projects\zstack\ZNP\CC253x\Source\znp_soc.c #
#                          " -D xPOWER_SAVING -D NV_RESTORE -lC               #
#                          "C:\Documents and Settings\Administrator\×ÀÃæ\1\Te #
#                          mcoZNP\Projects\zstack\ZNP\CC253x\CC2530-Debug\Lis #
#                          t\" -lA "C:\Documents and                          #
#                          Settings\Administrator\×ÀÃæ\1\TemcoZNP\Projects\zs #
#                          tack\ZNP\CC253x\CC2530-Debug\List\"                #
#                          --diag_suppress Pe001,Pa010 -o "C:\Documents and   #
#                          Settings\Administrator\×ÀÃæ\1\TemcoZNP\Projects\zs #
#                          tack\ZNP\CC253x\CC2530-Debug\Obj\" -e              #
#                          --no_code_motion --debug --core=plain --dptr=16,1  #
#                          --data_model=large --code_model=banked             #
#                          --calling_convention=xdata_reentrant               #
#                          --place_constants=data_rom --nr_virtual_regs 16    #
#                          -I "C:\Documents and Settings\Administrator\×ÀÃæ\1 #
#                          \TemcoZNP\Projects\zstack\ZNP\CC253x\" -I          #
#                          "C:\Documents and Settings\Administrator\×ÀÃæ\1\Te #
#                          mcoZNP\Projects\zstack\ZNP\CC253x\Source\" -I      #
#                          "C:\Documents and Settings\Administrator\×ÀÃæ\1\Te #
#                          mcoZNP\Projects\zstack\ZNP\CC253x\..\Source\" -I   #
#                          "C:\Documents and Settings\Administrator\×ÀÃæ\1\Te #
#                          mcoZNP\Projects\zstack\ZNP\CC253x\..\..\SE\Source\ #
#                          " -I "C:\Documents and Settings\Administrator\×ÀÃæ #
#                          \1\TemcoZNP\Projects\zstack\ZNP\CC253x\..\..\ZMain #
#                          \TI2530ZNP\" -I "C:\Documents and                  #
#                          Settings\Administrator\×ÀÃæ\1\TemcoZNP\Projects\zs #
#                          tack\ZNP\CC253x\..\..\..\..\Components\hal\include #
#                          \" -I "C:\Documents and Settings\Administrator\×ÀÃ #
#                          æ\1\TemcoZNP\Projects\zstack\ZNP\CC253x\..\..\..\. #
#                          .\Components\hal\target\CC2530ZNP\" -I             #
#                          "C:\Documents and Settings\Administrator\×ÀÃæ\1\Te #
#                          mcoZNP\Projects\zstack\ZNP\CC253x\..\..\..\..\Comp #
#                          onents\mac\include\" -I "C:\Documents and          #
#                          Settings\Administrator\×ÀÃæ\1\TemcoZNP\Projects\zs #
#                          tack\ZNP\CC253x\..\..\..\..\Components\mac\high_le #
#                          vel\" -I "C:\Documents and                         #
#                          Settings\Administrator\×ÀÃæ\1\TemcoZNP\Projects\zs #
#                          tack\ZNP\CC253x\..\..\..\..\Components\mac\low_lev #
#                          el\srf04\" -I "C:\Documents and                    #
#                          Settings\Administrator\×ÀÃæ\1\TemcoZNP\Projects\zs #
#                          tack\ZNP\CC253x\..\..\..\..\Components\mac\low_lev #
#                          el\srf04\single_chip\" -I "C:\Documents and        #
#                          Settings\Administrator\×ÀÃæ\1\TemcoZNP\Projects\zs #
#                          tack\ZNP\CC253x\..\..\..\..\Components\mt\" -I     #
#                          "C:\Documents and Settings\Administrator\×ÀÃæ\1\Te #
#                          mcoZNP\Projects\zstack\ZNP\CC253x\..\..\..\..\Comp #
#                          onents\osal\include\" -I "C:\Documents and         #
#                          Settings\Administrator\×ÀÃæ\1\TemcoZNP\Projects\zs #
#                          tack\ZNP\CC253x\..\..\..\..\Components\services\sa #
#                          ddr\" -I "C:\Documents and                         #
#                          Settings\Administrator\×ÀÃæ\1\TemcoZNP\Projects\zs #
#                          tack\ZNP\CC253x\..\..\..\..\Components\services\sd #
#                          ata\" -I "C:\Documents and                         #
#                          Settings\Administrator\×ÀÃæ\1\TemcoZNP\Projects\zs #
#                          tack\ZNP\CC253x\..\..\..\..\Components\stack\af\"  #
#                          -I "C:\Documents and Settings\Administrator\×ÀÃæ\1 #
#                          \TemcoZNP\Projects\zstack\ZNP\CC253x\..\..\..\..\C #
#                          omponents\stack\nwk\" -I "C:\Documents and         #
#                          Settings\Administrator\×ÀÃæ\1\TemcoZNP\Projects\zs #
#                          tack\ZNP\CC253x\..\..\..\..\Components\stack\sapi\ #
#                          " -I "C:\Documents and Settings\Administrator\×ÀÃæ #
#                          \1\TemcoZNP\Projects\zstack\ZNP\CC253x\..\..\..\.. #
#                          \Components\stack\sec\" -I "C:\Documents and       #
#                          Settings\Administrator\×ÀÃæ\1\TemcoZNP\Projects\zs #
#                          tack\ZNP\CC253x\..\..\..\..\Components\stack\sys\" #
#                           -I "C:\Documents and Settings\Administrator\×ÀÃæ\ #
#                          1\TemcoZNP\Projects\zstack\ZNP\CC253x\..\..\..\..\ #
#                          Components\stack\zcl\" -I "C:\Documents and        #
#                          Settings\Administrator\×ÀÃæ\1\TemcoZNP\Projects\zs #
#                          tack\ZNP\CC253x\..\..\..\..\Components\stack\zdo\" #
#                           -I "C:\Documents and Settings\Administrator\×ÀÃæ\ #
#                          1\TemcoZNP\Projects\zstack\ZNP\CC253x\..\..\..\..\ #
#                          Components\zmac\" -I "C:\Documents and             #
#                          Settings\Administrator\×ÀÃæ\1\TemcoZNP\Projects\zs #
#                          tack\ZNP\CC253x\..\..\..\..\Components\zmac\f8w\"  #
#                          -Ohz --require_prototypes                          #
#    List file          =  C:\Documents and Settings\Administrator\×ÀÃæ\1\Tem #
#                          coZNP\Projects\zstack\ZNP\CC253x\CC2530-Debug\List #
#                          \znp_soc.lst                                       #
#    Object file        =  C:\Documents and Settings\Administrator\×ÀÃæ\1\Tem #
#                          coZNP\Projects\zstack\ZNP\CC253x\CC2530-Debug\Obj\ #
#                          znp_soc.r51                                        #
#                                                                             #
#                                                                             #
###############################################################################

C:\Documents and Settings\Administrator\×ÀÃæ\1\TemcoZNP\Projects\zstack\ZNP\CC253x\Source\znp_soc.c
      1          /**************************************************************************************************
      2            Filename:       znp_soc.c
      3            Revised:        $Date: 2010-11-22 08:13:43 -0800 (Mon, 22 Nov 2010) $
      4            Revision:       $Revision: 24480 $
      5          
      6            Description:
      7          
      8            This file is the HAL-specific Application implementation for the ZNP by 8051 SOC.
      9          
     10          
     11            Copyright 2010 Texas Instruments Incorporated. All rights reserved.
     12          
     13            IMPORTANT: Your use of this Software is limited to those specific rights
     14            granted under the terms of a software license agreement between the user
     15            who downloaded the software, his/her employer (which must be your employer)
     16            and Texas Instruments Incorporated (the "License").  You may not use this
     17            Software unless you agree to abide by the terms of the License. The License
     18            limits your use, and you acknowledge, that the Software may not be modified,
     19            copied or distributed unless embedded on a Texas Instruments microcontroller
     20            or used solely and exclusively in conjunction with a Texas Instruments radio
     21            frequency transceiver, which is integrated into your product.  Other than for
     22            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     23            works of, modify, distribute, perform, display or sell this Software and/or
     24            its documentation for any purpose.
     25          
     26            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     27            PROVIDED “AS IS” WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED,
     28            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE,
     29            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     30            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     31            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     32            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     33            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     34            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     35            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     36            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     37          
     38            Should you have any questions regarding your right to use this Software,
     39            contact Texas Instruments Incorporated at www.TI.com.
     40          **************************************************************************************************/
     41          
     42          /* ------------------------------------------------------------------------------------------------
     43           *                                          Includes
     44           * ------------------------------------------------------------------------------------------------
     45           */
     46          
     47          #include "comdef.h"
     48          #include "hal_board_cfg.h"

   \                                 In  segment SFR_AN, at 0xe1
   \   unsigned char volatile __sfr RFST
   \                     RFST:
   \   000000                DS 1
     49          #include "mac_radio_defs.h"
     50          #include "MT.h"
     51          #include "OSAL.h"
     52          #include "OSAL_Nv.h"
     53          #include "znp_app.h"
     54          
     55          /* ------------------------------------------------------------------------------------------------
     56           *                                           Macros
     57           * ------------------------------------------------------------------------------------------------
     58           */
     59          
     60          #define MAC_RADIO_TX_ON()     st( RFST = ISTXON;   )
     61          
     62          #define MOD_IF             4     // ~Modulation bit of MDMTEST1 register.
     63          #define TX_PWR_MOD__SET(MOD_) st ( \
     64            if ((MOD_)) \
     65            { \
     66              MDMTEST1 |= BV(MOD_IF); \
     67            } \
     68            else \
     69            { \
     70              MDMTEST1 &= ~BV(MOD_IF); \
     71            } \
     72          );
     73          
     74          #define TX_PWR_TONE_SET(TONE) st ( \
     75            MDMTEST0 &= ~0xF0; \
     76            MDMTEST0 |= (TONE << 4); \
     77          )
     78          
     79          /**************************************************************************************************
     80           * @fn          znpTestRF
     81           *
     82           * @brief       This function initializes and checks the ZNP RF Test Mode NV items. It is designed
     83           *              to be invoked before/instead of MAC radio initialization.
     84           *
     85           * input parameters
     86           *
     87           * None.
     88           *
     89           * output parameters
     90           *
     91           * None.
     92           *
     93           * @return      None.
     94           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
     95          void znpTestRF(void)
   \                     znpTestRF:
     96          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 4
   \   000005   74FC         MOV     A,#-0x4
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
     97            uint8 rfTestParms[4] = { 0, 0, 0, 0 };
   \   00000A   90....       MOV     DPTR,#`?<Constant {0, 0, 0, 0}>`
   \   00000D   C082         PUSH    DPL
   \   00000F   85..82       MOV     DPL,?XSP + 0
   \   000012   85..83       MOV     DPH,?XSP + 1
   \   000015   AC82         MOV     R4,DPL
   \   000017   AD83         MOV     R5,DPH
   \   000019   7583..       MOV     DPH,#(`?<Constant {0, 0, 0, 0}>` >> 8) & 0xff
   \   00001C   D082         POP     DPL
   \   00001E   7404         MOV     A,#0x4
   \   000020   12....       LCALL   ?MOVE_LONG8_XDATA_XDATA
     98          
     99            if ((SUCCESS != osal_nv_item_init(ZNP_NV_RF_TEST_PARMS, 4, rfTestParms))  ||
    100                (SUCCESS != osal_nv_read(ZNP_NV_RF_TEST_PARMS, 0, 4, rfTestParms)) ||
    101                (rfTestParms[0] == 0))
   \   000023                ; Setup parameters for call to function osal_nv_item_init
   \   000023   85..82       MOV     DPL,?XSP + 0
   \   000026   85..83       MOV     DPH,?XSP + 1
   \   000029   8582..       MOV     ?V0 + 0,DPL
   \   00002C   8583..       MOV     ?V0 + 1,DPH
   \   00002F   78..         MOV     R0,#?V0 + 0
   \   000031   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000034   7C04         MOV     R4,#0x4
   \   000036   7D00         MOV     R5,#0x0
   \   000038   7A07         MOV     R2,#0x7
   \   00003A   7B0F         MOV     R3,#0xf
   \   00003C   12....       LCALL   ??osal_nv_item_init?relay
   \   00003F   7402         MOV     A,#0x2
   \   000041   12....       LCALL   ?DEALLOC_XSTACK8
   \   000044   E9           MOV     A,R1
   \   000045   702C         JNZ     ??znpTestRF_0
   \   000047                ; Setup parameters for call to function osal_nv_read
   \   000047   78..         MOV     R0,#?V0 + 0
   \   000049   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00004C   75..04       MOV     ?V0 + 0,#0x4
   \   00004F   75..00       MOV     ?V0 + 1,#0x0
   \   000052   78..         MOV     R0,#?V0 + 0
   \   000054   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000057   7C00         MOV     R4,#0x0
   \   000059   7D00         MOV     R5,#0x0
   \   00005B   7A07         MOV     R2,#0x7
   \   00005D   7B0F         MOV     R3,#0xf
   \   00005F   12....       LCALL   ??osal_nv_read?relay
   \   000062   7404         MOV     A,#0x4
   \   000064   12....       LCALL   ?DEALLOC_XSTACK8
   \   000067   E9           MOV     A,R1
   \   000068   7009         JNZ     ??znpTestRF_0
   \   00006A   85..82       MOV     DPL,?XSP + 0
   \   00006D   85..83       MOV     DPH,?XSP + 1
   \   000070   E0           MOVX    A,@DPTR
   \   000071   700A         JNZ     ??znpTestRF_1
    102            {
    103              return;
   \                     ??znpTestRF_0:
   \   000073   7404         MOV     A,#0x4
   \   000075   12....       LCALL   ?DEALLOC_XSTACK8
   \   000078   7F02         MOV     R7,#0x2
   \   00007A   02....       LJMP    ?BANKED_LEAVE_XDATA
    104            }
    105          
    106            // Settings from SmartRF Studio
    107            MDMCTRL0 = 0x85;
   \                     ??znpTestRF_1:
   \   00007D   9061A8       MOV     DPTR,#0x61a8
   \   000080   7485         MOV     A,#-0x7b
   \   000082   F0           MOVX    @DPTR,A
    108            RXCTRL = 0x3F;
   \   000083   9061AB       MOV     DPTR,#0x61ab
   \   000086   743F         MOV     A,#0x3f
   \   000088   F0           MOVX    @DPTR,A
    109            FSCTRL = 0x5A;
   \   000089   A3           INC     DPTR
   \   00008A   745A         MOV     A,#0x5a
   \   00008C   F0           MOVX    @DPTR,A
    110            FSCAL1 = 0x2B;
   \   00008D   9061AE       MOV     DPTR,#0x61ae
   \   000090   742B         MOV     A,#0x2b
   \   000092   F0           MOVX    @DPTR,A
    111            AGCCTRL1 = 0x11;
   \   000093   9061B2       MOV     DPTR,#0x61b2
   \   000096   7411         MOV     A,#0x11
   \   000098   F0           MOVX    @DPTR,A
    112            ADCTEST0 = 0x10;
   \   000099   9061B5       MOV     DPTR,#0x61b5
   \   00009C   14           DEC     A
   \   00009D   F0           MOVX    @DPTR,A
    113            ADCTEST1 = 0x0E;
   \   00009E   A3           INC     DPTR
   \   00009F   740E         MOV     A,#0xe
   \   0000A1   F0           MOVX    @DPTR,A
    114            ADCTEST2 = 0x03;
   \   0000A2   A3           INC     DPTR
   \   0000A3   7403         MOV     A,#0x3
   \   0000A5   F0           MOVX    @DPTR,A
    115          
    116            FRMCTRL0 = 0x43;
   \   0000A6   906189       MOV     DPTR,#0x6189
   \   0000A9   7443         MOV     A,#0x43
   \   0000AB   F0           MOVX    @DPTR,A
    117            FRMCTRL1 = 0x00;
   \   0000AC   A3           INC     DPTR
   \   0000AD   E4           CLR     A
   \   0000AE   F0           MOVX    @DPTR,A
    118          
    119            MAC_RADIO_RXTX_OFF();
   \   0000AF   75E1EF       MOV     0xe1,#-0x11
    120            MAC_RADIO_SET_CHANNEL(rfTestParms[1]);
   \   0000B2   75F005       MOV     B,#0x5
   \   0000B5   04           INC     A
   \   0000B6   12....       LCALL   ?XSTACK_DISP0_8
   \   0000B9   E0           MOVX    A,@DPTR
   \   0000BA   A4           MUL     AB
   \   0000BB   24D4         ADD     A,#-0x2c
   \   0000BD   90618F       MOV     DPTR,#0x618f
   \   0000C0   F0           MOVX    @DPTR,A
    121            MAC_RADIO_SET_TX_POWER(rfTestParms[2]);
   \   0000C1   7402         MOV     A,#0x2
   \   0000C3   12....       LCALL   ?XSTACK_DISP0_8
   \   0000C6   E0           MOVX    A,@DPTR
   \   0000C7   906190       MOV     DPTR,#0x6190
   \   0000CA   F0           MOVX    @DPTR,A
    122            TX_PWR_TONE_SET(rfTestParms[3]);
   \   0000CB   9061B8       MOV     DPTR,#0x61b8
   \   0000CE   E0           MOVX    A,@DPTR
   \   0000CF   540F         ANL     A,#0xf
   \   0000D1   F0           MOVX    @DPTR,A
   \   0000D2   7403         MOV     A,#0x3
   \   0000D4   12....       LCALL   ?XSTACK_DISP0_8
   \   0000D7   E0           MOVX    A,@DPTR
   \   0000D8   C4           SWAP    A
   \   0000D9   54F0         ANL     A,#0xf0
   \   0000DB   F8           MOV     R0,A
   \   0000DC   9061B8       MOV     DPTR,#0x61b8
   \   0000DF   E0           MOVX    A,@DPTR
   \   0000E0   48           ORL     A,R0
   \   0000E1   F0           MOVX    @DPTR,A
    123          
    124            switch (rfTestParms[0])
   \   0000E2   85..82       MOV     DPL,?XSP + 0
   \   0000E5   85..83       MOV     DPH,?XSP + 1
   \   0000E8   E0           MOVX    A,@DPTR
   \   0000E9   14           DEC     A
   \   0000EA   6008         JZ      ??znpTestRF_2
   \   0000EC   14           DEC     A
   \   0000ED   600A         JZ      ??znpTestRF_3
   \   0000EF   14           DEC     A
   \   0000F0   600E         JZ      ??znpTestRF_4
   \   0000F2   800F         SJMP    ??znpTestRF_5
    125            {
    126            case 1:  // Rx promiscuous mode.
    127              MAC_RADIO_RX_ON();
   \                     ??znpTestRF_2:
   \   0000F4   75E1E3       MOV     0xe1,#-0x1d
    128              break;
   \   0000F7   800A         SJMP    ??znpTestRF_5
    129          
    130            case 2:  // Un-modulated Tx.
    131              TX_PWR_MOD__SET(1);
   \                     ??znpTestRF_3:
   \   0000F9   9061B9       MOV     DPTR,#0x61b9
   \   0000FC   E0           MOVX    A,@DPTR
   \   0000FD   D2E4         SETB    0xE0 /* A   */.4
   \   0000FF   F0           MOVX    @DPTR,A
    132              // no break;
    133          
    134            case 3:  // Modulated Tx.
    135              // Modulated is default register setting, so no special action.
    136          
    137              // Now turn on Tx power for either mod or un-modulated Tx test.
    138              MAC_RADIO_TX_ON();
   \                     ??znpTestRF_4:
   \   000100   75E1E9       MOV     0xe1,#-0x17
    139              break;
    140          
    141            default:  // Not expected.
    142              break;
    143            }
    144          
    145            // Clear the RF test mode.
    146            (void)osal_memset(rfTestParms, 0, 4);
   \                     ??znpTestRF_5:
   \   000103                ; Setup parameters for call to function osal_memset
   \   000103   7C04         MOV     R4,#0x4
   \   000105   7D00         MOV     R5,#0x0
   \   000107   7900         MOV     R1,#0x0
   \   000109   85..82       MOV     DPL,?XSP + 0
   \   00010C   85..83       MOV     DPH,?XSP + 1
   \   00010F   AA82         MOV     R2,DPL
   \   000111   AB83         MOV     R3,DPH
   \   000113   12....       LCALL   ??osal_memset?relay
    147            (void)osal_nv_write(ZNP_NV_RF_TEST_PARMS, 0, 4, rfTestParms);
   \   000116                ; Setup parameters for call to function osal_nv_write
   \   000116   85..82       MOV     DPL,?XSP + 0
   \   000119   85..83       MOV     DPH,?XSP + 1
   \   00011C   8582..       MOV     ?V0 + 0,DPL
   \   00011F   8583..       MOV     ?V0 + 1,DPH
   \   000122   78..         MOV     R0,#?V0 + 0
   \   000124   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000127   75..04       MOV     ?V0 + 0,#0x4
   \   00012A   75..00       MOV     ?V0 + 1,#0x0
   \   00012D   78..         MOV     R0,#?V0 + 0
   \   00012F   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000132   7C00         MOV     R4,#0x0
   \   000134   7D00         MOV     R5,#0x0
   \   000136   7A07         MOV     R2,#0x7
   \   000138   7B0F         MOV     R3,#0xf
   \   00013A   12....       LCALL   ??osal_nv_write?relay
   \   00013D   7404         MOV     A,#0x4
   \   00013F   12....       LCALL   ?DEALLOC_XSTACK8
    148          
    149            while (1);  // Spin in RF test mode until a hard reset.
   \                     ??znpTestRF_6:
   \   000142   80FE         SJMP    ??znpTestRF_6
   \   000144                REQUIRE RFST
    150          }

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??znpTestRF?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    znpTestRF

   \                                 In  segment XDATA_ROM_C, align 1
   \                     `?<Constant {0, 0, 0, 0}>`:
   \   000000   00           DB 0
   \   000001   00           DB 0
   \   000002   00           DB 0
   \   000003   00           DB 0
    151          
    152          /**************************************************************************************************
    153          */

   Maximum stack usage in bytes:

     Function               ISTACK PSTACK XSTACK
     --------               ------ ------ ------
     znpTestRF                  2      0     18
       -> osal_nv_item_init     0      0     32
       -> osal_nv_read          0      0     36
       -> osal_memset           0      0     28
       -> osal_nv_write         0      0     36


   Segment part sizes:

     Function/Label           Bytes
     --------------           -----
     RFST                        1
     znpTestRF                 324
     ??znpTestRF?relay           6
     ?<Constant {0, 0, 0, 0}>    4

 
 324 bytes in segment BANKED_CODE
   6 bytes in segment BANK_RELAYS
   1 byte  in segment SFR_AN
   4 bytes in segment XDATA_ROM_C
 
 330 bytes of CODE  memory
   4 bytes of CONST memory
   0 bytes of DATA  memory (+ 1 byte shared)

Errors: none
Warnings: none
